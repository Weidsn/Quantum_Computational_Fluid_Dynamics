qfunc load_b(amplitudes: real[], output state: qbit[]) {
  prepare_amplitudes(amplitudes, 0.0, state);
}

qfunc hhl(rhs_vector: real[], precision: int, hamiltonian_evolution_with_power: qfunc (int, qbit[]), output state: qbit[], output phase: qnum, output indicator: qbit) {
  allocate(precision, UNSIGNED, precision, phase);
  load_b([
    (-0.008854480004996593),
    (-0.17725898010002747),
    (-0.15441119008713441),
    0.17760157010022076,
    0.4142877502337831,
    0.44735303025244183,
    (-0.711377150401431),
    0.18788080010602135
  ], state);
  allocate(indicator);
  within {
    qpe_flexible(lambda(k) {
      hamiltonian_evolution_with_power(k, state);
    }, phase);
  } apply {
    indicator *= (1 / (2 ** phase.size)) / phase;
  }
}

qfunc unitary_with_power_logic(pw: int, matrix: real[][], target: qbit[]) {
  power (pw) {
    unitary(matrix, target);
  }
}

qfunc main(output res: qnum, output phase: qnum, output indicator: qbit) {
  hhl([
    (-0.008854480004996593),
    (-0.17725898010002747),
    (-0.15441119008713441),
    0.17760157010022076,
    0.4142877502337831,
    0.44735303025244183,
    (-0.711377150401431),
    0.18788080010602135
  ], 7, lambda(arg0, arg1) {
    unitary_with_power_logic(arg0, [
      [
        (0.5348879236515578 + 0.538626578648289j),
        (0.3870808962838243 - 0.29780241316390266j),
        (0.06740768484444323 - 0.09562662702375078j),
        (0.15521179302677246 - 0.15111596716751355j),
        (0.13930566913417483 + 0.15698989699906463j),
        (0.08930751724564578 - 0.04262951882311741j),
        ((-0.13163074628461552) - 0.12047571427446593j),
        ((-0.19237476096438882) + 0.044151227319098985j)
      ],
      [
        (0.38708089628382447 - 0.29780241316390277j),
        (0.5645359465404227 + 0.43379776474427745j),
        ((-0.08794762136089682) + 0.12533673685177732j),
        ((-0.09712003272374692) + 0.0036189238997380146j),
        ((-0.17107547900481834) + 0.0106622493997887j),
        (0.03813673593923446 - 0.14375349101254087j),
        (0.061063246178643386 + 0.1242470738037673j),
        (0.2871972725827322 - 0.2618453342935182j)
      ],
      [
        (0.06740768484444325 - 0.09562662702375078j),
        ((-0.08794762136089679) + 0.12533673685177735j),
        (0.8278702907192211 + 0.31855851438284605j),
        (0.011297629664981983 + 0.06472477513971725j),
        (0.2456500290902362 - 0.08256257477729496j),
        (0.1692757488373106 - 0.033979707927099125j),
        ((-0.2359623427157778) - 0.10407557381256591j),
        (0.0437214552107797 - 0.0794421745346809j)
      ],
      [
        (0.15521179302677252 - 0.1511159671675136j),
        ((-0.09712003272374693) + 0.00361892389973803j),
        (0.011297629664981972 + 0.06472477513971726j),
        (0.9116194108231903 + 0.1885507550099098j),
        ((-0.13423034925664273) - 0.08733589324688189j),
        ((-0.11490156687632092) + 0.0042573281381877714j),
        (0.17628758988058663 - 0.013669948782364272j),
        (0.039207359246905944 + 0.03228555961402534j)
      ],
      [
        (0.13930566913417486 + 0.15698989699906468j),
        ((-0.17107547900481834) + 0.01066224939978875j),
        (0.2456500290902362 - 0.08256257477729496j),
        ((-0.13423034925664268) - 0.08733589324688186j),
        (0.22372109424016684 + 0.18932573919710016j),
        ((-0.37042463976497775) - 0.1702170893546069j),
        (0.7326609628348684 + 0.06042367459576667j),
        (0.17185374214397625 - 0.108172495880684j)
      ],
      [
        (0.08930751724564576 - 0.042629518823117385j),
        (0.03813673593923446 - 0.1437534910125409j),
        (0.1692757488373106 - 0.033979707927099076j),
        ((-0.11490156687632092) + 0.004257328138187758j),
        ((-0.3704246397649778) - 0.17021708935460694j),
        (0.613105445255677 + 0.298083533130936j),
        (0.5035419068801013 - 0.027800875014681092j),
        ((-0.06396044642802473) + 0.1889428213786628j)
      ],
      [
        ((-0.1316307462846156) - 0.12047571427446602j),
        (0.0610632461786433 + 0.1242470738037673j),
        ((-0.23596234271577785) - 0.10407557381256587j),
        (0.17628758988058665 - 0.013669948782364287j),
        (0.7326609628348686 + 0.06042367459576669j),
        (0.5035419068801013 - 0.02780087501468111j),
        (0.1560935695557113 + 0.1445241079084272j),
        ((-0.04972797380275611) - 0.09339711065278529j)
      ],
      [
        ((-0.19237476096438882) + 0.044151227319099j),
        (0.28719727258273214 - 0.2618453342935181j),
        (0.0437214552107797 - 0.07944217453468087j),
        (0.03920735924690594 + 0.032285559614025336j),
        (0.17185374214397625 - 0.108172495880684j),
        ((-0.06396044642802473) + 0.18894282137866286j),
        ((-0.049727973802756134) - 0.09339711065278528j),
        (0.7684684263310243 + 0.341218740611312j)
      ]
    ], arg1);
  }, res, phase, indicator);
}
